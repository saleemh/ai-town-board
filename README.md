# AI Town Board Prep System

AI-powered municipal document processing system with intelligent PDF-to-Markdown conversion using IBM Docling.

## 🎯 Current Status 

**✅ What This System Does:**
- 📝 **Intelligent PDF Processing** - Uses IBM Docling with OCR, table extraction, and hierarchical structure preservation
- 🏛️ **Municipal Code Processing** - Automatically segments large municipal codes using PDF Table of Contents
- 📄 **PDF Fragment Traceability** - Preserves original PDF segments alongside generated markdown for complete transparency
- 🔄 **Hierarchical Document Structure** - Maintains legal document hierarchy with proper cross-referencing
- 🖥️ **Simple CLI** - Easy commands for processing complex municipal documents

**📋 How It Works:**
1. **Place PDFs** in the appropriate directory structure
2. **System analyzes** document type and extracts Table of Contents structure
3. **Intelligent segmentation** breaks large documents into manageable chapter-based segments
4. **IBM Docling processes** each segment with advanced OCR and structure detection
5. **Markdown generation** with preserved hierarchy, tables, and cross-references
6. **PDF fragment preservation** ensures complete traceability back to source material

## Quick Start

1. **Install dependencies:**
   ```bash
   pip install -r requirements.txt
   ```

2. **Set up API keys (for AI processing):**
   ```bash
   export OPENAI_API_KEY="your-openai-api-key"       # Optional: for AI analysis
   export ANTHROPIC_API_KEY="your-anthropic-api-key" # Optional: for AI analysis
   ```

3. **Process Municipal Code:**
   ```bash
   # Place your municipal code PDF in: data/town-code/originals/
   cp "Town of North Castle, NY.pdf" data/town-code/originals/
   
   # Process the entire municipal code automatically
   python -m src ingest-town-code
   ```

4. **Reprocess with new PDFs:**
   ```bash
   # Add new/updated PDFs to data/town-code/originals/
   # Then reprocess everything:
   python -m src ingest-town-code --force
   ```

## 📋 Available Commands

| Command | Description | Status |
|---------|-------------|---------|
| `python -m src status` | Show system configuration and processing status | ✅ Ready |
| `python -m src ingest-town-code` | Process municipal code PDFs with intelligent TOC-driven segmentation | ✅ **COMPLETE** |
| `python -m src ingest-town-code --force` | Reprocess all municipal code PDFs (use when adding new PDFs) | ✅ **COMPLETE** |
| `python -m src process --date YYYY-MM-DD` | Process documents for specific meeting date | 🔄 Future Development |
| `python -m src process-all` | Process all meetings in data directory | 🔄 Future Development |

## 📁 Directory Structure

### 🏛️ Municipal Code Processing (IMPLEMENTED)

```
data/town-code/
├── originals/                          # 📄 Input: Your municipal code PDFs
│   └── Town of North Castle, NY.pdf    # Place your PDF here
├── markdown/                           # 📝 Output: Generated markdown & fragments
│   ├── chapters/                       # Individual chapter markdown files
│   │   ├── L01-3-general-provisions.md
│   │   ├── L01-13-boards-bureaus-and-committees.md
│   │   ├── L01-18-ethics-code-of.md
│   │   └── ... (42 total chapters)
│   ├── pdf-segments/                   # PDF fragments for traceability
│   │   ├── L01-3-general-provisions.pdf     # Pages 3-7 (5 pages)
│   │   ├── L01-13-boards-bureaus-and-committees.pdf  # Pages 10-26 (17 pages)
│   │   └── ... (42 corresponding PDF segments)
│   ├── index.md                        # Master table of contents with hierarchy
│   ├── metadata.json                   # Complete processing metadata
│   └── search-index.json              # Search index for content lookup
```

### 📋 Meeting Documents (FUTURE)

```
data/meetings/YYYY-MM-DD-regular/
├── originals/              # 📄 Input: Your PDF documents
│   ├── agenda.pdf
│   ├── minutes.pdf
│   └── attachments/
│       └── additional-docs.pdf
├── markdown/               # 📝 Output: AI-processed Markdown
│   ├── agenda.md           # Generated by Docling
│   ├── minutes.md
│   └── attachments/
│       └── additional-docs.md
├── analysis/               # 🤖 AI agent analysis results
│   ├── town-attorney-review.md
│   └── summary.md
└── metadata.json           # 📊 Processing metadata and status
```

## 🚀 Implementation Status

### ✅ Phase 1: Municipal Code Processing - **COMPLETE**
- [x] **Universal PDF Processing System** - Handles any PDF type with intelligent detection
- [x] **IBM Docling Integration** - Advanced PDF → Markdown conversion with OCR
- [x] **TOC-Driven Segmentation** - Automatically segments large PDFs using built-in Table of Contents
- [x] **Hierarchical Structure Preservation** - Maintains legal document hierarchy and cross-references
- [x] **PDF Fragment Traceability** - Saves PDF segments alongside markdown for complete transparency
- [x] **Smart Document Type Detection** - Automatically identifies municipal code vs. other document types
- [x] **Progress Tracking & Logging** - Comprehensive processing status and time estimation
- [x] **Master Index Generation** - Creates searchable index with hierarchical navigation
- [x] **Metadata & Search Index** - Complete processing metadata and content search capabilities

### 🏛️ **Current Capability: North Castle Municipal Code**
- **790-page PDF** → **42 chapter-based markdown files**
- **1,739 TOC entries** parsed into hierarchical structure
- **Complete PDF fragment preservation** for each chapter
- **Processing time**: ~0.4 minutes per chapter segment

### 🔄 Phase 2: Meeting Document Processing (FUTURE)
- [ ] Meeting agenda intelligent parsing
- [ ] Minutes processing with speaker identification
- [ ] Multi-document packet handling
- [ ] Cross-document reference extraction

### 🤖 Phase 3: AI Agent Framework (FUTURE)  
- [ ] Agent architecture with plugin system
- [ ] Town Attorney agent for legal analysis
- [ ] Automated summaries and insights
- [ ] Historical trend analysis
- [ ] Alert system for significant items

## 🛠️ Technical Architecture

**Current Implementation:**
- **Document Processing**: IBM Docling for PDF → Markdown conversion
- **AI Integration**: OpenAI/Anthropic API for intelligent analysis
- **File Management**: Structured directory processing with metadata tracking
- **Configuration**: YAML-based configuration for all processing parameters

**Technology Stack:**
- Python 3.8+ for core processing
- IBM Docling for advanced PDF processing and AI extraction
- OpenAI/Anthropic APIs for language model integration
- Click for CLI interface
- YAML for configuration management

## 📖 Example Usage

**Check system status:**
```bash
$ python -m src status
🏛️  AI Town Board Prep System Status

📋 Configuration:
  Data Directory: ./data
  ✅ Data directory exists
  📁 Existing meetings: 3
  📄 Meetings with PDFs: 3
  📝 Meetings with Markdown: 0
  💡 Run 'python -m src process-all' to convert PDFs to Markdown
```

**Process a specific meeting:**
```bash
$ python -m src process --date 2025-08-04
Processing documents for meeting date: 2025-08-04
Found 2 PDF documents:
  📄 agenda.pdf
  📄 minutes.pdf
✅ Successfully processed 2 documents
  ✅ agenda.pdf → agenda.md
  ✅ minutes.pdf → minutes.md
```

**Process all meetings:**
```bash
$ python -m src process-all
Found 3 meeting directories:
  📁 2025-07-21-regular
  📁 2025-08-04-regular
  📁 2025-08-13-regular

📋 Processing 2025-07-21-regular...
  ✅ agenda.pdf → agenda.md
  ✅ minutes.pdf → minutes.md
...
✅ Successfully processed 6 documents total
```

**Process municipal code:**
```bash
$ python -m src ingest-town-code
🏛️  Processing Municipal Code: Town of North Castle, NY.pdf
📂 Output directory: data/town-code/markdown

📚 PROCESSING PLAN:
   Total segments: 42
   Total pages: 790
   Estimated processing time: 84-210 minutes
   Each segment will be processed individually with Docling

🔄 PROCESSING SEGMENT 1 of 42
   Section: chapter 1: General Provisions
   Pages: 3-7 (5 pages)
   Progress: 0/42 completed (0.0%)
   🔄 Starting Docling processing for segment...
   ✅ Created permanent PDF segment: L01-3-general-provisions.pdf
   ✅ SEGMENT 1 COMPLETED in 0.4 minutes

✅ Successfully processed municipal code!
📊 Processing Summary:
  📄 Total pages: 790
  📚 Total chapters: 42
  ✅ Successful chapters: 42
  ❌ Failed chapters: 0
  🕐 Total processing time: 16.8 minutes

📁 Output files created:
  📄 Index: data/town-code/markdown/index.md
  📊 Metadata: data/town-code/markdown/metadata.json
  🔍 Search Index: data/town-code/markdown/search-index.json
  📚 Chapters: data/town-code/markdown/chapters/ (42 files)
  📄 PDF Segments: data/town-code/markdown/pdf-segments/ (42 files)
```

## 🔧 Adding Your Documents

### 🏛️ Municipal Code PDFs

Simply place your municipal code PDF in the input directory:

```bash
# Create directory if it doesn't exist
mkdir -p data/town-code/originals

# Add your municipal code PDF
cp "Your Town Code.pdf" data/town-code/originals/

# Process automatically
python -m src ingest-town-code
```

**📄 System automatically handles:**
- Document type detection (Municipal Code vs. other types)
- TOC extraction from PDF bookmarks/outline
- Intelligent chapter-level segmentation 
- Hierarchical structure preservation
- PDF fragment creation for traceability

**💡 Document Sources:**
- Municipal website code repositories
- Legal document archives
- Official town/city government portals
- Legislative document databases

## 📋 Next Steps

### For Users:
1. **Add your municipal code PDF** to `data/town-code/originals/`
2. **Run the processor**: `python -m src ingest-town-code`  
3. **Explore results** in `data/town-code/markdown/`
   - Browse individual chapters in `chapters/`
   - Check original PDF segments in `pdf-segments/`
   - Use `index.md` for hierarchical navigation
4. **For updates**: Use `python -m src ingest-town-code --force` to reprocess

### For Developers:
- **See `AI_TOWN_BOARD_PREP_SPEC.md`** for complete technical specification
- **Current system** is production-ready for municipal code processing
- **Next priority**: Meeting document processing pipeline
- **Future priority**: AI agent framework for legal analysis

## 🔗 Additional Documentation

- **[Technical Specification](AI_TOWN_BOARD_PREP_SPEC.md)** - Complete system design and architecture
- **Configuration** - See `config/` directory for processing settings
- **License** - MIT License (see LICENSE file)